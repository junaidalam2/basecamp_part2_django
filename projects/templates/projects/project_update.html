{% extends 'base.html' %}


{% block content %}

<br>
<h2>UPDATE PROJECT</h2>

<form action='.' method='POST'>
    {% csrf_token %}

    <div class="form-floating mb-3">
        {% if form.name.value %}
          <input type="text" class="form-control" id="id_name" value="{{ form.name.value }}">
        {% else %}
        <label for="id_name">{{ form.name.label_tag }}</label>
          <input type="text" class="form-control" id="id_name" placeholder="Enter Project Name">
        {% endif %}
            <div class="invalid-feedback">
                {{ form.name.errors }}
            </div>
    </div>
    

    <label for="id_description">{{ form.description.label_tag }}</label>
    {{ form.description }} {{ form.description.errors }}

    <label for="id_time_frame_for_completion">{{ form.time_frame_for_completion.label_tag }}</label>
    {{ form.time_frame_for_completion }} {{ form.time_frame_for_completion.errors }}

    <label for="id_status">{{ form.status.label_tag }}</label>
    {{ form.status }} {{ form.status.errors }}

    <h3>Assign Team Leads</h3>
    <label for="id_team_leads">{{ form.team_leads.label_tag }}</label>
    <div id="team_leads_container">
        {{ form.team_leads }} {{ form.team_leads.errors }}
    </div>

    <h3>Assign Team Members</h3>
    <label for="id_team_members">{{ form.team_members.label_tag }}</label>
    <div id="team_members_container">
        {{ form.team_members }} {{ form.team_members.errors }}
    </div>

    <input type='submit' value='Save Changes' />
</form>

<h3>Uploaded Files:</h3>
<ul>
    {% for file in file_uploads %}
        <li>
            <a href="{{ file.file.url }}">{{ file.file.name }}</a>
            <form action="{% url 'projects:file_upload_delete' file.pk %}" method="POST" style="display:inline;">
                {% csrf_token %}
                <button type="button" class="delete-button" data-file-id="{{ file.pk }}">Delete</button>
                <input type="hidden" name="confirm" value="0">
            </form>
        </li>
    {% empty %}
        <li>No files uploaded yet.</li>
    {% endfor %}
</ul>

<a href="{% url 'projects:upload_file' project.pk %}">Upload Files</a>

<a href="{% url 'projects:projects-list' %}">Back to Project List</a>


<script>

document.addEventListener('DOMContentLoaded', function() {
        const deleteButtons = document.querySelectorAll('.delete-button');

        deleteButtons.forEach(button => {
            button.addEventListener('click', function() {
                // Check if button is already in "Are you sure?" state
                if (this.textContent === 'Delete') {
                    this.textContent = 'Are you sure?';
                } else {
                    // Proceed with the delete action
                    this.closest('form').submit();
                }

                // Reset all other delete buttons
                deleteButtons.forEach(btn => {
                    if (btn !== this && btn.textContent === 'Are you sure?') {
                        btn.textContent = 'Delete';
                    }
                });
            });
        });

        // Reset button text when clicking anywhere else
        document.addEventListener('click', function(event) {
            deleteButtons.forEach(button => {
                if (button.textContent === 'Are you sure?' && !button.contains(event.target)) {
                    button.textContent = 'Delete';
                }
            });
        });
    });
    
    const teamLeadsContainer = document.getElementById('team_leads_container');
    const teamMembersContainer = document.getElementById('team_members_container');

    function updateOptions() {
        const selectedLeads = Array.from(teamLeadsContainer.querySelectorAll('input[type="checkbox"]:checked')).map(input => input.value);
        const selectedMembers = Array.from(teamMembersContainer.querySelectorAll('input[type="checkbox"]:checked')).map(input => input.value);

        Array.from(teamMembersContainer.querySelectorAll('input[type="checkbox"]')).forEach(input => {
            input.disabled = selectedLeads.includes(input.value);
        });

        Array.from(teamLeadsContainer.querySelectorAll('input[type="checkbox"]')).forEach(input => {
            input.disabled = selectedMembers.includes(input.value);
        });
    }

    teamLeadsContainer.addEventListener('change', updateOptions);
    teamMembersContainer.addEventListener('change', updateOptions);

    updateOptions();
</script>


{% endblock %}